---
- secret:
    name: SECRET_METALBOX
    data:
      MINIO_ACCESS_KEY: !encrypted/pkcs1-oaep
        - B3Nh2gnveiS/V4k6U1tspkA0xfJraobTe+kCJ4ploQ/D8PIEsamZrg+TDvfShYa3QAjPT
          qCia5DPUUZJpcZK7bb9BQPkb4PxiGVQd+3LRaVVlYTze94LJhd6nNspQTiyek2NrefewC
          ygr0YK6CHGtbuhW7AG/XwlORtvayVB81IQenM0VbAHsbvsXn/qqJVHmZ7DxTzQVbIq4WV
          GCyD2cTTFl0DJE4kpIZtbd6qDA7aIx+/Iuv8vxuxnXbJY2abWx7pWmjuS6yNQ7udTxH2l
          4p2r914sZj8/PetcgvphcfVN0BDLe1Gj73NPI9IVmhAOncBlvUd7sF5TTel0u3THlPj6T
          zca2B9ZnFOuXbBqc7B+aXURBHoAd5ayNRazlGvsDUDbJKrP1x7ztAY1JzwIbv6lsY6On0
          PqPf3c4/yIOSOZlg4xr0+QLl1DkdoS37Nm6f11vHvhQ495eYf0KPkjPTwo848qcTVfrh/
          ctn+19eP3njt/xo5S7zPKUS9owlgP2ouK9AqNwtbxZ2oGge1Ui87axSyGiGYQ1d4unHsg
          tz3yZNVUXySLJ6dChYWXw2dYJ07PvkGzArX5yBYfTDfSl6jm+5oLYmoHdaE6gX7n5z/g1
          KSJ3rPwLW8fgEDXHFJuxGDuXHX/Q/FE9SY0xtgFoJ52xAC6lRBoxOCcPFO/uCM=
      MINIO_SECRET_KEY: !encrypted/pkcs1-oaep
        - HG7JL1tEUDAKMMlWKEy7tuBgoDE6/VXZYIZ8loi6n4mbCmHjoOKV9voeRACMj5qyjk8yU
          MiYspS4/2EXFsRozJLGIwwPMPJRRvKbSY0VUjd5+brYaIsllzCoJ8lmf95FDrY6WEQ72H
          SoYIitcvOLMheC8gdPbFeybS5Tzp1Qp5V7zvg4eX1oXg0n1y0jTADy3pGHE4fHmq6PjTB
          lY7GVYMQp3rysBsEiYd5hUQAafWPfylGHiVWbppatbrrdAlQzeAZZT+lrf8loGM+gVMn+
          pyxGbp5lDxSO8DyxLgdB81L4WGvHr6E+rleroDrDgDuk7vZAHdcuP7sKkH+ZUR0X71nf7
          ouX7QWEmUZ4LkIF6hO8SCtkVarIFjh/R7GA8pJbgG32iUsSjlrLhH6GdjNnFYPIWuol1D
          u/tQyjI+Z+4YBwDD1aYDKJqr+UUSqBSlk0/haPuT+0fOlDyZKpSEgAGnYqsdRx+XJUu6y
          6p4LehxT81MSTiMkIFiPbfo+lWfxjkVc0klDbhIpxoV1LdaqnwvndMsyddVgpFnxX2QGz
          Ah/Pi5ysdP9rbL8CBebXrx2Aq8sor4tZCYwEfM4zV1ekPsX1wmA39onOAUvxf1qCFz401
          CXbUG2VxBJU5E025D10HC1W0cz5tvAVWtxAlEB5tQp15A8IsxtWdhDpvZmrQMI=
      DOCKER_USERNAME: !encrypted/pkcs1-oaep
        - j2hYqCUclQl1wvlA8tgkyjw5POn3DphMHuyTVqb1rDfacUa9EaavglRf75OI2vjxBxhRP
          KFY2tJyEeIHvrtan7YVhjy8KxcwqRVAWvkcGyz9sYgR1bG+jkBDoatyaSHMokTFy79v+D
          YoT7MKv6nE5Tamf0S9izxIGqphQYRPvjMoQBLqZREPWNH4BbBGJMCRTIcyD4JIPdRDegf
          9q6GDrr4snVK9MCC2J+yGOM2ipQnbw3jZNquNUhwTfd1P9GPXsgssOOJUtGUihhhZiA+y
          A5mtN+Z7o/7Fn3RFIcKAt/CdMt6vFfzPMPM23EzsRLwpIrbJ1ruH+ketqIe4Ox2t6ovr5
          vgNauLJ024PX/xdG5R9Rw/Rx8EUtGDa/5/NUGWNHq8OszXQLJk5zosOx0lAB48KqI8jO+
          32w4PqVmiKpVBkGqGwOzxbi3n2T6fsPDeWuVLrEHSfyFiNw7eGd1CmlJ6MOiL7vSva6Ig
          p0nMeuMQhJ2cBZHL+rXah5Jvjt5sen35qGdchT+mQgiuTLYLWRcYoyuXw6ziUfbqJ/GFz
          up4ItHopS96ni+LGkcxTqmQs9VWJT8Frg9CjkQUHSBvs4gSqs2G58CYUJrp1hbWqSXh6n
          kPc4bPoG7uXQmeGoWaXWAFlOO/bXb85vKI6n52G5tXiUJmpnwtmsykgeYTCIGs=
      DOCKER_PASSWORD: !encrypted/pkcs1-oaep
        - Qj4+Sglwq/xuLvrM4hPHSORLXzyi9TeNI6vik10DpJ+Z4KU7UsxWoM/4r0XP+2AKn1rtT
          +9sfGg0Bbj3P2fqwZmQt6hZG6KwNoNQvrZwL4z6JJkOsKYZSaLIOBbrM2By7DYwC8TYBA
          lyfzdorDRONjfVQRvoe0LZ9FV+qZEPjs0yuT73ZUg0/8uW5xhcr5wwzmnrT2dh3Iw0wJ6
          bomK6j7y6sbyxKZ9BqFOoTkfABbxkbAc1w0dfR4+0cA82qT5PX5Z/At8UIWZZqObRq7nM
          PUkgxUlgJerLiRxI6yRwyzJWgXTFcjAgPGGeG7G5XJ5drPo+946FD/MSBqmAMZxSt/cVV
          PO+qnBcO2zkj5h67zzZni9OyUkXyYuRAaMs4vWxfgaG0aecLHy65F9M7cZo46kjkXhjm8
          eT8EgSgQaclulYv1fvXXBiJzfgs53hXGgIbUv3Cp1LlzBJINUbi7o7Z7eyiOeKvN0E7Pi
          1CiYShkY5U8uCx/6v0FEbV0EBSXqHTmENolisrKrN7+hOLIHoOwOs4RttvXjGpflVrIuO
          SAOQMPgNluSZ4pYb2wxWqr3WehPPQZb+3aexCAdjocix1bPJl86CUm0qTAFC/uiSezjbU
          ZWX+FaMvPDtz19IZ/rTAIjR6KhIaHpN5VkjUvk24nIA0LgLC8D7Jn/ZW8MMxi0=

- job:
    name: metalbox-mirror-debian-packages
    nodeset: ubuntu-noble-large
    pre-run: zuul/pre-mirror-debian-packages.yml
    run: zuul/mirror-debian-packages.yml
    timeout: 16200
    files:
      - "^zuul/mirror-debian-packages.yml"
      - "^zuul/pre-mirror-debian-packages.yml"
      - "^zuul/files/create-mirror.sh"
      - "^zuul/files/packages.list"
      - "^zuul/files/repositories.conf"

- job:
    name: metalbox-mirror-container-images
    nodeset: ubuntu-noble-large
    pre-run: zuul/pre-mirror-container-images.yml
    run: zuul/mirror-container-images.yml
    files:
      - "^zuul/mirror-container-images.yml"
      - "^zuul/pre-mirror-container-images.yml"
      - "^zuul/vars/container-images.yml"

- job:
    name: metalbox-mirror-debian-packages-publish
    parent: metalbox-mirror-debian-packages
    vars:
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- job:
    name: metalbox-mirror-container-images-publish
    parent: metalbox-mirror-container-images
    vars:
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- project:
    merge-mode: squash-merge
    default-branch: main
    check:
      jobs:
        - metalbox-mirror-container-images
        - metalbox-mirror-debian-packages
        - ansible-lint
        - yamllint
    periodic-daily:
      jobs:
        - ansible-lint
        - metalbox-mirror-container-images-publish
        - metalbox-mirror-debian-packages-publish
        - yamllint
    post:
      jobs:
        - metalbox-mirror-container-images-publish:
            branches: main
        - metalbox-mirror-debian-packages-publish:
            branches: main
