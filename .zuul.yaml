---
- secret:
    name: SECRET_METALBOX
    data:
      MINIO_ACCESS_KEY: !encrypted/pkcs1-oaep
        - hgmRMzyDqj5ANem0+ZXN9Fl/OjPJoNhhO+XBAS/qbjwWBnpC6/FVvXtfabl9/IXCN067s
          /X9raFBxcvoaiMwBHL7/+uOcxTG160QmURvQKQWf46joT8GEnw5xEPOR5E9LAQ6unh4tY
          T937Xww8Z9TPnHu/U2imqOiuiUpo+I3uCN/i6bnFqWvEo5HUDJ5QXMtWNicbvv+QMV1nb
          ffbCvit5zXTixdhJ3eMY6zgGAm9mGgdF4UcE/wjfXN6aC5P2yJdHRXsPI7Ro0xZGZLUGr
          o820g4iWRYOHROp2M1NKTG35QFzH3LPOXm8NGw9LDrgRyDUuac2Y+2vEOZVw/lqJBr0GP
          rs3I54GzevXUYD5b2HWMwOJq7nZaHjWFFVEursZs2gT1QtAIDiy8uzgE1B0TXkZN5j94e
          U/C2GgoE1K9W5cX2glMv40M/urLv10Sd4YhfNjMAaeJRO0Aeq03bnXqiFYQNmMuZ+CVK1
          hLtj1eiQJY35QseZxT/ITJvFvfaTzNQMJmPhXi9J6DS/QsC3QF1JBjuDyio7D68oPk7+z
          H2c02vFoRsDElTZyDyb1dkBWvXFvJFl7T8K0VSS8L5Mp4W+Qu1jMknX1B1y9aamHVrxDy
          L/HLtD70Vp2r7Od8pJODDQLkZsX0FEdrPtChcrRhSwCzWrT8cKo1arfI8PlpwM=
      MINIO_SECRET_KEY: !encrypted/pkcs1-oaep
        - DCwCuqa8RApMO4frYARfqODmruxSKMjVwQMF0Dl2k4CEE0QYQusWLPlijTIG5AunlBO88
          1s+hwk0syZltJRv0LJmtoPXGrxK8m9Go4BIbS6Mm52EDHNk5J+lQNoaRydijK5y+mfhOS
          VGVrQSvXJbAu5EwprnL3wgUTe54jHWEmhBw7G4zzxS24kLL5Mmk6ohSy/kCcdC1CLDEad
          qSLIdlIxzAX5Ez1lzuyjmkdY2fuBLntU8RxptvleXPpBRF3OkglILzOeKgCEA4rxZGl5b
          v435YMNieNDqmKvFFtyRzuEd6BnGSkXIN+kqPa8e6bjxc8VsEB3OuqHvNj8YOCDH8BCpP
          yEVnuhQ8S8Nfv0F3qF//4/gDoa+lh1iuJre5mpBzjAvESJY+4XqprfC5rhGnkeVaIgVnh
          A4GIs75QE9AWWORcNEaPzaBVOB4ikYVPpE9K7asuegV7v8J/irzzWG3lp8gDr16pMYu1E
          3Gz24oxJElPLY0/E8fqlR/7mdLf4agzHKAULch02iYNn5BD4SOqda/D1hL/0lHkdnf6wn
          EAeVDPT6emQx4ifSD89kNhSKP2/RGW+3wYQEhvkJIKtLMWw1Xh5qi4+iYkdK7h18XqjAl
          fVK7RI1t41pDAy1PFmQw567x3tO1kIMyiCxW3lKrOSRO9ZMwN3fcVt+3cJeBus=
      DOCKER_USERNAME: !encrypted/pkcs1-oaep
        - gT/RzZatr3AuaEn5sJ3NqGqZZJ+V8n6cZ8wweRvUpV1/uJfN7G47QwYHVrXer8lFvkkZQ
          aVwAiWikrufedumRoAuJDWBKEbfKeBzt5XIzt3V8vC7TSi2ihzENgK3/SQiPbdmNDncrG
          bDOJmt1fGVEHYGja0OOrB3FAGnzuyzEdHL0Zsvj5813HhhP6/EODK0dOF65iUYIYThH0c
          B4VJl0krt1OsYpai70ZVOIkXP5thbaLSlPHUN/Ph8eaJV+iTX5eQ5IXvpFoKWfLW8j4Ea
          BK5/2C48p3NqbC9K194Iu6ud/m1XFM1qk2vp3NRb1cSNzYGH75nJBOOgqzpUKRDmVzXDT
          wBswEGDnPYlV7GRorXMBZP3cwuUquyp2bH+itQsN46/hftBFHbVRzZfPl05b4S7YFy3yE
          WyETGkMGCUx56gWTlRTHXxUz39Ey52BLg/KuDyiLQov6xViRex4I9EjQxT/wKkyaFt7on
          XJfWrDt/8AZ4uXw9A58uvLgXCGZK5ydvzajSfb1k3lBFWsMKu1h9o6zVsOdxB67/Sz+pE
          oxnZ0CFWvHXFpR6k0HrgXqdz/fFELoVBmoB1Gapw14L3bU98PAROjIQIfsJ1HhNlZM6wh
          SHAcKCprQ5C5+8kgNazEijHwaq+PcYHUKeCG48Okmveeh5GmdCasEfQhC/mPO4=
      DOCKER_PASSWORD: !encrypted/pkcs1-oaep
        - qUq4UdCFxz9afucNah5qwj1+SANBmX0OTR0pMYcxr2fStQzEAPvNZbzUBe61jTq9eIA6J
          eoOSLIKwWKZm6xnysa/actVer0TubyTvHFSkHDDWp0IMZDicBjlSoTpW9pfK/cvq7HpUx
          tfZKk2mgEgnY6n83pQbzluXmkGJxpGx6taec20gvgu52ylbgc4NQj4Mnb9CW1W8k6omEK
          IEd846ATOiC7752aO+dAol9bVjE+Jd8O2094A50SPMOwk7DoA7oI7hE/aDAUvOFPSXOLA
          pfqOmP/uIySpB15IX3vwWnCOFIm6KZTmFsUEUNjL3Rp9l4iN4P1rO164DVgDX+SwnAqrI
          1MzWe7mfG2C8IoMJ+FlnPKdtwyD1S3o5w0RMErb9j5jNqre2mhrM70flXfiS9H6fxvSHE
          6UqYzF9HfBHFCwYBUNxXiV8flTrdhtmrk0fBRPytJzX03dMlp3gGZttp+XMsurH5U8vdy
          zCE4PlXCZfVjbgT6nyHCXaMK91hPpELV5DTn8kVlxhbkNkWA8wWgZhjJwG0YjX9vZwDnn
          i/PYJ43PKW1ZEL0Tqf0xEHO+a9bGwpSYuaxvwCc5H3D8SfIwCBwIPH3OhijcvhMYaKbIr
          zYM+aaGMeT1RWJ2tDJzZSekOKNwSXmBSG8bPqxUV3XxIMxPIKKX0bSTSkjeq6I=

- semaphore:
    name: semaphore-metalbox-mirror-debian-packages-publish
    max: 1

- semaphore:
    name: semaphore-metalbox-mirror-container-images-publish
    max: 1

- semaphore:
    name: semaphore-metalbox-mirror-container-images-full-publish
    max: 1

- semaphore:
    name: semaphore-metalbox-mirror-octavia-image-publish
    max: 1

- job:
    name: metalbox-mirror-debian-packages
    nodeset: ubuntu-noble-large
    pre-run: zuul/pre-mirror-debian-packages.yml
    run: zuul/mirror-debian-packages.yml
    timeout: 16200
    files:
      - "^zuul/files/Containerfile"
      - "^zuul/files/create-mirror.sh"
      - "^zuul/files/packages.list"
      - "^zuul/files/repositories.conf"
      - "^zuul/mirror-debian-packages.yml"
      - "^zuul/pre-mirror-debian-packages.yml"

- job:
    name: metalbox-mirror-container-images
    nodeset: ubuntu-noble-large
    pre-run: zuul/pre-mirror-container-images.yml
    run: zuul/mirror-container-images.yml
    files:
      - "^zuul/mirror-container-images.yml"
      - "^zuul/pre-mirror-container-images.yml"
      - "^zuul/vars/container-images.yml"

- job:
    name: metalbox-mirror-container-images-full
    parent: metalbox-mirror-container-images
    timeout: 3600
    vars:
      full: true

- job:
    name: metalbox-mirror-octavia-image
    nodeset: ubuntu-noble-large
    pre-run: zuul/pre-mirror-octavia-image.yml
    run: zuul/mirror-octavia-image.yml
    files:
      - "^scripts/octavia-export.sh$"
      - "^zuul/mirror-octavia-image.yml"
      - "^zuul/pre-mirror-octavia-image.yml"

- job:
    name: metalbox-mirror-debian-packages-publish
    parent: metalbox-mirror-debian-packages
    semaphores:
      - name: semaphore-metalbox-mirror-debian-packages-publish
    vars:
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- job:
    name: metalbox-mirror-container-images-publish
    parent: metalbox-mirror-container-images
    semaphores:
      - name: semaphore-metalbox-mirror-container-images-publish
    vars:
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- job:
    name: metalbox-mirror-container-images-full-publish
    parent: metalbox-mirror-container-images
    semaphores:
      - name: semaphore-metalbox-mirror-container-images-full-publish
    timeout: 3600
    vars:
      full: true
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- job:
    name: metalbox-mirror-octavia-image-publish
    parent: metalbox-mirror-octavia-image
    semaphores:
      - name: semaphore-metalbox-mirror-octavia-image-publish
    vars:
      publish: true
    secrets:
      - name: secret
        secret: SECRET_METALBOX
        pass-to-parent: true

- project:
    merge-mode: squash-merge
    default-branch: main
    check:
      jobs:
        - metalbox-mirror-container-images
        - metalbox-mirror-container-images-full
        - metalbox-mirror-debian-packages
        - metalbox-mirror-octavia-image
        - ansible-lint
        - yamllint
    periodic-midnight:
      jobs:
        - metalbox-mirror-debian-packages-publish
    periodic-daily:
      jobs:
        - ansible-lint
        - metalbox-mirror-container-images-publish
        - metalbox-mirror-container-images-full-publish
        - yamllint
    post:
      jobs:
        - metalbox-mirror-container-images-publish:
            branches: main
        - metalbox-mirror-container-images-full-publish:
            branches: main
        - metalbox-mirror-debian-packages-publish:
            branches: main
        - metalbox-mirror-octavia-image-publish:
            branches: main
